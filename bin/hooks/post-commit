#!/usr/bin/env bash


main() {

	# redirect stderr to stdout, to ensure logs are printed anyway
	exec 2>&1
	local git_root="$(git rev-parse --show-toplevel)"
	exec &>${git_root}/post-commit.log

	# set default status as success
	local status=0
	
	# do the main goal of this hook
	rebuild_worktree
	status=$?

	# exit with status from the stuff we did: nonzero prevents commit
	exit $status
}

rebuild_worktree() {
	echo "rebuilding worktree"
	git ls-files -z | xargs -0 rm -rfv
	git checkout .
	git submodule init
	git submodule update
}


main
