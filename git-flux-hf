#!/usr/bin/env sh


USAGE="hf <start|finish> <version> [-h]"

LONG_USAGE="
${t_bold}${t_fg_red}hf${t_off}
--

handle lifecycle of hot-fixes.


${t_bold}available actions:${t_off}

   ${t_bold}start <version>${t_off}
      start a hot-fix; create a local branch and push it to the remote.
      the branch name will be composed of the pre-configured hot-fix prefix and the passed ${t_bold}version${t_off}.

   ${t_bold}finish <version>${t_off}
      finish an existing release-candidate; delete its local and remote branches, for good.
 "


cmd_start() {
	validate_mandatory_arg "$1"
	io_log "starting hot-fix '$1'..."
	create_branch_from_tag "$(git_config_get "prefix.hf")$1" "$(git_tag_template "$1")"
	io_log_ok "hot-fix '$1' is started. good luck!"
}

cmd_finish() {
	# todo - exclude package.json, shrinkwrap.json, pom.xml when merging back
	validate_mandatory_arg "$1"
	io_confirm "the local and remote branches of '$1' will be deleted, forever! continue?" "i knew you'd chicken out."
	io_log "finishing hot-fix '$1'..."
	destroy_branch_from_tag "$(git_config_get "prefix.hf")$1"
	io_log_ok "hot-fix '$1' is finished. goodbye!"
}
