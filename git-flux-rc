#!/usr/bin/env sh


USAGE="rc <start|finish> <next-version> [-h]"

LONG_USAGE="
${t_bold}${t_fg_green}rc${t_off}
--

handle lifecycle of release-candidates.


${t_bold}available actions:${t_off}

   ${t_bold}start <next-version>${t_off}
      start a release-candidate; create a local branch and push it to the remote.
      the branch name will be composed of the pre-configured release-candidate prefix and the passed ${t_bold}next-version${t_off}.

   ${t_bold}finish <next-version>${t_off}
      finish an existing release-candidate; delete its local and remote branches, for good.
 "


cmd_start() {
	validate_mandatory_arg "$1"
	io_log; create_branch_from_base "$(git_config_get "prefix.rc")$1" "$(git_config_get "branch.integration")"
	io_log; io_log_ok "release candidate '$1' is created. congrats!"; io_log

	# optional tagging of RC forks, it's here should we need it sometime
#	local tag="$(git_tag_template "$next_version" "-rc")"
#	validate_git_tag_not_exists "$tag"
#	git_create_tag $tag "version '$next_version' release candidate"
#	git_push $tag
}

cmd_finish() {
	validate_mandatory_arg "$1"
	io_log; destroy_branch_from_base "$(git_config_get "prefix.rc")$1"
	io_log; io_log_ok "release candidate '$1' is finished. goodbye!"; io_log
}
